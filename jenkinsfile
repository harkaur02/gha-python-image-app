pipeline {
    agent any
    environment {
        // DOCKERHUB_CREDENTIALS = 'docker-credentials'
        REGISTRY_CREDENTIALS = credentials('docker-credentials')
        DOCKER_IMAGE = "thethymca/gha-python-image-app:v1"
        //DOCKER_IMAGE = "thethymca/gha-python-image-app:${BUILD_NUMBER}"
    }
    stages {
        stage('Hello') {
            steps {
                echo 'Hello World'
            }
        }
        stage('Build and Push Docker Image') {
                steps {
        script {
            sh 'cd gha-python-image-app && docker build -t ${DOCKER_IMAGE} .'
            echo 'inside folder'
            echo DOCKER_IMAGE
            def dockerImage = docker.image("${DOCKER_IMAGE}")
            docker.withRegistry('https://index.docker.io/v1/', "docker-cred") {
                dockerImage.push()
            }
        }
      }
        }
    }
}
